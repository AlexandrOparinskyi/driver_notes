from aiogram.enums import ContentType
from aiogram_dialog import Dialog, Window
from aiogram_dialog.widgets.input import MessageInput
from aiogram_dialog.widgets.kbd import Button, Row, Url, Select, Column, Group
from aiogram_dialog.widgets.text import Format

from bot.states import HomeState
from .getters import (getter_home,
                      getter_home_write_developer,
                      getter_home_instructions,
                      getter_home_get_instruction,
                      getter_home_select_record,
                      getter_home_donate,
                      getter_home_donate_start,
                      getter_home_get_payment_link,
                      getter_home_not_car)
from .handlers import (home_write_developer,
                       home_instructions,
                       home_get_instruction,
                       home_garage,
                       home_add_param,
                       home_service_record,
                       home_lk,
                       home_donate,
                       create_donate_payments_btn,
                       create_donate_payments_msg,
                       home_donate_start,
                       create_donate_payments_start_msg,
                       create_donate_payments_stars_btn,
                       home_refuel_record,
                       home_add_car)
from ..general import (service_in_development,
                       home_button, generale_message_not_text)

home_dialog = Dialog(
    Window(
        Format("{home_text}"),
        Button(text=Format("{add_record_button}"),
               id="add_record_button",
               on_click=home_add_param),
        Row(Button(text=Format("{garage_button}"),
                   id="garage_button",
                   on_click=home_garage),
            Button(text=Format("{lk_button}"),
                   id="lk_button",
                   on_click=home_lk)),
        Row(Button(text=Format("{instructions_button}"),
                   id="instructions_button",
                   on_click=home_instructions),
            Button(text=Format("{reviews_button}"),
                   id="reviews_button",
                   on_click=service_in_development)),
        Button(text=Format("{support_project_button}"),
               id="support_project_button",
               on_click=home_donate),
        Button(text=Format("{write_developer_button}"),
               id="write_developer_button",
               on_click=home_write_developer),
        getter=getter_home,
        state=HomeState.home
    ),
    Window(
        Format("{home_write_developer_text}"),
        Url(text=Format("{developer_button}"),
            url=Format("{developer_url}")),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_write_developer,
        state=HomeState.write_developer
    ),
    Window(
        Format("{home_instruction_text}"),
        Column(Select(text=Format("{item[0]}"),
                      id="instructions",
                      item_id_getter=lambda x: x[1],
                      items="buttons",
                      on_click=home_get_instruction)),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_instructions,
        state=HomeState.instructions
    ),
    Window(
        Format("{instruction_text}"),
        Button(text=Format("{back_button}"),
               id="back_button",
               on_click=home_instructions),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_get_instruction,
        state=HomeState.get_instruction
    ),
    Window(
        Format("{select_record_text}"),
        Row(Button(text=Format("{service_button}"),
                   id="service_button",
                   on_click=home_service_record),
            Button(text=Format("{refuel_button}"),
                   id="refuel_button",
                   on_click=home_refuel_record)),
        Row(Button(text=Format("{purchase_button}"),
                   id="purchase_button",
                   on_click=service_in_development),
            Button(text=Format("{service_other_button}"),
                   id="service_other_button",
                   on_click=service_in_development)),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_select_record,
        state=HomeState.select_record
    ),
    Window(
        Format("{donate_text}"),
        MessageInput(func=create_donate_payments_msg,
                     content_types=ContentType.TEXT),
        MessageInput(func=generale_message_not_text,
                     content_types=[ContentType.VIDEO,
                                    ContentType.PHOTO,
                                    ContentType.DOCUMENT,
                                    ContentType.STICKER]),
        Group(Select(text=Format("{item[0]} ₽"),
                     id="price_sum",
                     item_id_getter=lambda x: x[1],
                     items="price_buttons",
                     on_click=create_donate_payments_btn),
              width=3),
        Button(text=Format("{home_donate_start_button}"),
               id="home_donate_start_button",
               on_click=home_donate_start),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_donate,
        state=HomeState.donate
    ),
    Window(
        Format("{donate_text}"),
        MessageInput(func=create_donate_payments_start_msg,
                     content_types=ContentType.TEXT),
        MessageInput(func=generale_message_not_text,
                     content_types=[ContentType.VIDEO,
                                    ContentType.PHOTO,
                                    ContentType.DOCUMENT,
                                    ContentType.STICKER]),
        Group(Select(text=Format("{item[0]} ⭐"),
                     id="price_sum_star",
                     item_id_getter=lambda x: x[1],
                     items="stars_button",
                     on_click=create_donate_payments_stars_btn),
              width=3),
        Button(text=Format("{home_donate_rubles_button}"),
               id="home_donate_rubles_button",
               on_click=home_donate),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_donate_start,
        state=HomeState.donate_stars
    ),
    Window(
        Format("{donate_payment_text}"),
        Url(text=Format("{pay_button}"),
            url=Format("{link}")),
        Button(text=Format("{back_button}"),
               id="back_button",
               on_click=home_donate),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_get_payment_link,
        state=HomeState.get_link
    ),
    Window(
        Format("{no_car_text}"),
        Button(text=Format("{add_car_button}"),
               id="add_car_button",
               on_click=home_add_car),
        Button(text=Format("{garage_button}"),
               id="garage_button",
               on_click=home_garage),
        Button(text=Format("{home_button}"),
               id="home_button",
               on_click=home_button),
        getter=getter_home_not_car,
        state=HomeState.not_car
    )
)
